<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JustFuckingGoogleIt</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/homepage-modern.css">
  <link rel="stylesheet" href="/css/theme.css">
  <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.10.4/gsap.min.js"></script>
  <!-- CSRF Token for AJAX requests -->
  <meta name="csrf-token" content="<%= csrfToken %>">
</head>
<body>
  <header>
    <nav>
      <a href="/" class="logo">
        <img src="/img/logo.png" alt="JustFuckingGoogleIt">
      </a>
      <ul>
        <li><a href="#" id="themeToggle">Change Theme</a></li>
        <li><a href="#" id="characterToggle">Change Character</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <section class="hero">
      <div class="character">
        <img src="<%= characterImage %>" alt="Character" id="characterImage">
        <canvas id="chalkboardCanvas"></canvas>
      </div>
      <div class="message-container">
        <div class="message-wrapper">
          <p class="message" id="animate-text">Just Google It</p>
          <p class="message">Your "pal" sent you here for asking stupid questions and not asking Google first. They sent you here to make you laugh and teach you a hard lesson. ;)</p>
          <p class="message">Don't worry, we've got your back! Use our search bar powered by Google to find the answers you need.</p>
          <p class="message">And if you want to give your friend a taste of their own medicine, use our URL shortener to create a JFGI link and share it with them!</p>
        </div>
      </div>
    </section>
    <div class="container">
      <!-- Search form (GET request, doesn't need CSRF token) -->
      <form id="searchForm" action="/search" method="get">
        <div class="search-bar">
          <input type="text" name="q" id="searchInput" placeholder="Search..." aria-label="Search" value="just fucking google it">
          <button type="submit" aria-label="Search">
            <img src="/img/search-icon.svg" alt="Search">
          </button>
        </div>
      </form>
      <!-- URL shortener form (POST request, includes CSRF token) -->
      <form id="shortenForm" class="url-shortener" action="/shorten" method="POST">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <div class="shorten-bar">
          <textarea id="urlInput" name="urls" placeholder="Enter long URL(s)..." aria-label="Enter long URL(s)" rows="3"></textarea>

          <!-- Difficulty Selector -->
          <div class="difficulty-selector">
            <label for="difficulty">ğŸ® Challenge Difficulty:</label>
            <select id="difficulty" name="difficulty">
              <option value="simple">ğŸ˜Š Simple (60s) - Easy for beginners</option>
              <option value="medium" selected>ğŸ¤” Medium (120s) - Requires Googling</option>
              <option value="hard">ğŸ˜° Hard (180s) - Multi-step research</option>
              <option value="expert">ğŸ’€ Expert (300s) - Extremely difficult</option>
            </select>
          </div>

          <!-- Custom Challenge (Optional, Collapsible) -->
          <details class="custom-challenge">
            <summary>ğŸ“ Custom Challenge (Advanced)</summary>
            <div>
              <label for="challengeText">Custom Question:</label>
              <input type="text" id="challengeText" name="challengeText" placeholder="e.g., Find the world's most popular search engine">

              <label for="hints">Custom Hints (one per line):</label>
              <textarea id="hints" name="hints" placeholder="Hint 1: It starts with G&#10;Hint 2: Founded in 1998&#10;Hint 3: Uses 4 colors" rows="3"></textarea>
            </div>
          </details>

          <button type="submit" aria-label="Shorten URL(s)">
            <img src="/img/shorten-icon.svg" alt="">
            <span>Shorten URL</span>
          </button>
        </div>
      </form>
      <!-- Container for displaying shortened URLs -->
      <div id="shortUrlContainer" class="short-url-container" aria-live="polite">
        <% if (typeof shortCodes !== 'undefined' && shortCodes.length > 0) { %>
          <h2>Shortened URLs:</h2>
          <ul>
            <% shortCodes.forEach(function(shortCode) { %>
              <li>
                <a href="/shorturl/<%= shortCode %>" target="_blank">
                  <%= `${origin}/shorturl/${shortCode}` %>
                </a>
              </li>
            <% }); %>
          </ul>
        <% } %>
      </div>
      <!-- Loading indicator -->
      <div id="loadingIndicator" class="loading-indicator" aria-live="polite" style="display: none;">Loading...</div>
      <!-- Fact bubble -->
      <div id="factBubble" class="fact-bubble"></div>
    </div>
  </main>
  <footer>
    <p>&copy; <%= new Date().getFullYear() %> JustFuckingGoogleIt</p>
  </footer>
  <!-- JavaScript files -->
  <script src="/js/search.js"></script>
  <script src="/js/urlShortener.js"></script>
  <script src="/js/chalkboard.js"></script>
  <script src="/js/general.js"></script>
  <script src="/js/main.js"></script>
</body>
</html>